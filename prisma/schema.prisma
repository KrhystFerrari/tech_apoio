// Schema do TechApoio - Plataforma Educativa para Crianças
// Aprenda mais sobre Prisma: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Modelo de Usuário (Professor/Administrador)
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(TEACHER)
  school    String?  // Escola onde trabalha (opcional)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  students Student[]
  classes  Class[]
  reports  Report[]

  @@map("users")
}

// Tipos de usuário
enum UserRole {
  TEACHER
  ADMIN
}

// Modelo de Turma/Classe
model Class {
  id          String   @id @default(cuid())
  name        String
  description String?
  year        Int      // Ano escolar (1º, 2º, 3º, 4º, 5º ano)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  teacher   User      @relation(fields: [teacherId], references: [id])
  teacherId String
  students  Student[]

  @@map("classes")
}

// Modelo de Estudante
model Student {
  id        String   @id @default(cuid())
  name      String
  age       Int
  grade     Int      // Série/ano (1-5)
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  teacher      User             @relation(fields: [teacherId], references: [id])
  teacherId    String
  class        Class?           @relation(fields: [classId], references: [id])
  classId      String?
  progress     Progress[]
  scores       GameScore[]
  badges       StudentBadge[]
  rankings     StudentRanking[]
  reports      Report[]

  @@map("students")
}

// Modelo de Área de Conhecimento
model Subject {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  color       String   // Cor hexadecimal para a área
  icon        String   // Nome do ícone
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  activities Activity[]
  rankings   Ranking[]
  reports    Report[]

  @@map("subjects")
}

// Modelo de Atividade/Jogo
model Activity {
  id            String       @id @default(cuid())
  title         String
  description   String
  type          ActivityType
  difficulty    Difficulty   @default(EASY)
  minAge        Int          @default(6)
  maxAge        Int          @default(10)
  instructions  String
  content       Json         // Conteúdo específico da atividade (palavras, números, etc.)
  isActive      Boolean      @default(true)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  // Relacionamentos
  subject    Subject     @relation(fields: [subjectId], references: [id])
  subjectId  String
  progress   Progress[]
  gameScores GameScore[]

  @@map("activities")
}

// Tipos de atividade
enum ActivityType {
  WORD_FORMATION    // Formar palavras
  LETTER_RECOGNITION // Reconhecimento de letras
  INTERACTIVE_STORY // História interativa
  DIGITAL_DICTATION // Ditado digital
  WORD_SEARCH       // Caça-palavras
  COUNTING          // Contagem
  MATH_OPERATIONS   // Operações matemáticas
  NUMBER_PUZZLES    // Quebra-cabeças numéricos
  SHAPE_RECOGNITION // Reconhecimento de formas
  LOGICAL_SEQUENCE  // Sequência lógica
  VISUAL_PROGRAMMING // Programação visual
  ALGORITHM_BASICS  // Noções de algoritmo
  SIMPLE_COMMANDS   // Comandos simples
  BASIC_ANIMATIONS  // Animações básicas
  DRAG_DROP         // Arrastar e soltar
  INTERACTIVE_CYCLE // Ciclo interativo
  VIRTUAL_EXPERIMENT // Experimento virtual
}

// Níveis de dificuldade
enum Difficulty {
  EASY
  MEDIUM
  HARD
}

// Modelo de Progresso do Estudante
model Progress {
  id          String   @id @default(cuid())
  completed   Boolean  @default(false)
  attempts    Int      @default(0)
  bestScore   Int      @default(0)
  timeSpent   Int      @default(0) // Tempo em segundos
  lastPlayed  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  student    Student  @relation(fields: [studentId], references: [id])
  studentId  String
  activity   Activity @relation(fields: [activityId], references: [id])
  activityId String

  @@unique([studentId, activityId])
  @@map("progress")
}

// Modelo de Pontuação de Jogo
model GameScore {
  id        String   @id @default(cuid())
  score     Int
  timeSpent Int      // Tempo em segundos
  mistakes  Int      @default(0)
  hints     Int      @default(0)
  createdAt DateTime @default(now())

  // Relacionamentos
  student    Student  @relation(fields: [studentId], references: [id])
  studentId  String
  activity   Activity @relation(fields: [activityId], references: [id])
  activityId String

  @@map("game_scores")
}

// Modelo de Badges/Conquistas
model Badge {
  id          String     @id @default(cuid())
  name        String     @unique
  description String
  icon        String     // Emoji ou nome do ícone
  category    BadgeCategory
  requirement String     // Descrição do requisito
  points      Int        @default(10)
  rarity      BadgeRarity @default(COMMON)
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relacionamentos
  studentBadges StudentBadge[]

  @@map("badges")
}

// Categorias de badges
enum BadgeCategory {
  PROGRESS      // Badges de progresso
  ACHIEVEMENT   // Badges de conquista
  STREAK        // Badges de sequência
  MASTERY       // Badges de maestria
  SPECIAL       // Badges especiais
}

// Raridade dos badges
enum BadgeRarity {
  COMMON    // Comum
  RARE      // Raro  
  EPIC      // Épico
  LEGENDARY // Lendário
}

// Modelo de Badges conquistados por estudantes
model StudentBadge {
  id        String   @id @default(cuid())
  earnedAt  DateTime @default(now())

  // Relacionamentos
  student   Student @relation(fields: [studentId], references: [id])
  studentId String
  badge     Badge   @relation(fields: [badgeId], references: [id])
  badgeId   String

  @@unique([studentId, badgeId])
  @@map("student_badges")
}

// Modelo de Ranking/Leaderboard
model Ranking {
  id          String      @id @default(cuid())
  period      RankingPeriod
  subjectId   String?     // Opcional - ranking geral ou por matéria
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())

  // Relacionamentos
  subject     Subject?    @relation(fields: [subjectId], references: [id])
  rankings    StudentRanking[]

  @@map("rankings")
}

// Períodos de ranking
enum RankingPeriod {
  DAILY     // Diário
  WEEKLY    // Semanal  
  MONTHLY   // Mensal
  YEARLY    // Anual
  ALL_TIME  // Histórico
}

// Posições dos estudantes no ranking
model StudentRanking {
  id        String   @id @default(cuid())
  position  Int
  points    Int
  createdAt DateTime @default(now())

  // Relacionamentos
  student   Student  @relation(fields: [studentId], references: [id])
  studentId String
  ranking   Ranking  @relation(fields: [rankingId], references: [id])
  rankingId String

  @@unique([studentId, rankingId])
  @@map("student_rankings")
}

// Modelo para arquivos de mídia (áudio, imagem)
model MediaFile {
  id        String    @id @default(cuid())
  filename  String
  originalName String
  mimetype  String
  size      Int       // Tamanho em bytes
  url       String    // URL do arquivo
  type      MediaType
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relacionamentos
  words     Word[]    @relation("WordAudio")
  wordImages Word[]   @relation("WordImage")

  @@map("media_files")
}

// Tipos de mídia
enum MediaType {
  AUDIO
  IMAGE
  VIDEO
}

// Modelo de Relatórios para Professores
model Report {
  id          String     @id @default(cuid())
  title       String
  description String?
  type        ReportType
  data        Json       // Dados do relatório em JSON
  period      String     // Período do relatório
  createdAt   DateTime   @default(now())

  // Relacionamentos
  teacher     User       @relation(fields: [teacherId], references: [id])
  teacherId   String
  student     Student?   @relation(fields: [studentId], references: [id])
  studentId   String?
  subject     Subject?   @relation(fields: [subjectId], references: [id])
  subjectId   String?

  @@map("reports")
}

// Tipos de relatório
enum ReportType {
  STUDENT_PROGRESS    // Progresso individual
  CLASS_OVERVIEW      // Visão geral da turma
  SUBJECT_PERFORMANCE // Performance por matéria
  ACTIVITY_ANALYTICS  // Análise de atividades
  ENGAGEMENT_REPORT   // Relatório de engajamento
}

// Modelo de Palavras para jogos de Português
model Word {
  id          String     @id @default(cuid())
  word        String     @unique
  difficulty  Difficulty @default(EASY)
  category    String     // Categoria da palavra (animais, cores, etc.)
  syllables   Int        // Número de sílabas
  audioUrl    String?    // URL do áudio da palavra - DEPRECATED
  imageUrl    String?    // URL da imagem da palavra - DEPRECATED
  meaning     String?    // Significado da palavra
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relacionamentos com mídia
  audioFile   MediaFile? @relation("WordAudio", fields: [audioFileId], references: [id])
  audioFileId String?
  imageFile   MediaFile? @relation("WordImage", fields: [imageFileId], references: [id])
  imageFileId String?

  @@map("words")
}

// Modelo de Números para jogos de Matemática  
model Number {
  id        String     @id @default(cuid())
  number    Int        @unique
  written   String     // Número por extenso
  difficulty Difficulty @default(EASY)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("numbers")
}
